import pandas as pd
import numpy as np
from pathlib import Path
import math
from skeletonization import getScore
import os
        

def bin(percentages):
    bins = np.linspace(0, 1, 10)
    digitized = np.digitize(percentages, bins)
    counts = np.bincount(digitized)
    maxBin = np.argmax(counts)
    if isinstance(maxBin, np.ndarray):
        maxBin = np.amax(maxBin)
        binnedAverage = percentages[digitized == maxBin].mean()
    else:
        binnedAverage = percentages[digitized == maxBin].mean()
    return binnedAverage


def qthPercentilePerSegment(percDict, q):
    for segment, percentages in percDict.items():
        sumPercentage = 0
        average = None
        qthPerc = None
        binnedAverage = None
        if len(percentages) > 0:
            average = np.average(np.array(percentages))
            # average = sumPercentage / len(percentages) 
            qthPerc = np.percentile(np.array(percentages), q)
            binnedAverage = bin(percentages)
        percDict[segment] = binnedAverage

def averagePerSegment(percDict):
    for segment, percentages in percDict.items():
        sumPercentage = 0
        average = None
        if len(percentages) > 0:
            for percentage in percentages:
                sumPercentage += percentage
            average = sumPercentage / len(percentages) 
        percDict[segment] = average

def calculateErrors(predDict, gtDict, errorsDict):
    for segment, percentage in predDict.items():
        gt = gtDict[segment]
        if percentage != None and gt != None:
            error = abs((percentage - gt)/ gt) * 100
            errorsDict[segment].append(error)


if __name__ == "__main__":
    import argparse

     # Parse command line arguments
    parser = argparse.ArgumentParser(
        description='Generate segmentation masks of arteries')
    parser.add_argument('--csv_path', required=False,
                        default='B:/percentage_stenosis.csv',
                        metavar="/path/to/csv/",
                        help="Directory folder for csv file containing scores (default: B:/percentage_stenosis.csv)")
    parser.add_argument('--segmented_path', required=False,
                        default='A:/segmented',
                        metavar="/path/to/segmented masks",
                        help="Path to folder containing images and their segmentation maps (default: A:/segmented)")


    args = parser.parse_args()
    csv_path = args.csv_path
    pathString = args.segmented_path

    data = pd.read_csv(csv_path)

    data = pd.DataFrame(data)

    path = Path(pathString)

    errors = {
        'lad_p': [],
        'lad_m': [],
        'lad_d': [],
        'lcx2_p': [],
        'lcx2_m': [],
        'lcx2_d': [],
        'diagonal' : [],
        'lcx1' : []
    }

    for video in path.iterdir():
        row = data.loc[data['keyframe_id'] == float(video.name)].head()
        stenosisPercentages = {
            'lad_p': [],
            'lad_m': [],
            'lad_d': [],
            'lcx2_p': [],
            'lcx2_m': [],
            'lcx2_d': [],
            'diagonal' : [],
            'lcx1' : []
        }
        gtPercentages = {
            'lad_p': None,
            'lad_m': None,
            'lad_d': None,
            'lcx2_p': None,
            'lcx2_m': None,
            'lcx2_d': None,
            'diagonal' : None,
            'lcx1' : None
        }
        if len(row) > 0:
            row = row.iloc[0]
        else:
            continue
            # print(row)
        valid_arteries = []
        valid_segments = []
        for index, value in row.items():
            # print(value)
            if not math.isnan(value) and index != 'keyframe_id':
                artery = index.split('_')[0]
                if artery not in valid_arteries:
                    valid_arteries.append(artery)
                valid_segments.append(index)
                gtPercentages[index] = value

        for keyframe in video.iterdir():
            for artery in valid_arteries:
                filename = keyframe.name + '_' + artery
                # folderDirectory = pathString
                if os.path.exists(f"{pathString}/{filename.split('_')[0]}/{filename.split('.')[0].split('_')[0]}_{filename.split('.')[0].split('_')[1]}/{filename}_bin_mask.png"):
                    _, scores, boxes = getScore(filename, folderDirectory=pathString, show=False, save=True)
                    # print(f'{filename}: ' ,scores)
                    if scores != None and len(scores) > 0:
                        print('processed: ', filename)
                        for key, score in scores.items():
                            segmentName = artery + '_' + key
                            if artery == 'lcx1' or artery == 'diagonal':
                                segmentName = artery
                            if segmentName in valid_segments:
                                stenosisPercentages[segmentName].append(score)

        
        qthPercentilePerSegment(stenosisPercentages, 80)
        print(f'{video.name}: raw percentages', stenosisPercentages)
        calculateErrors(stenosisPercentages, gtPercentages, errors)

    print('raw errors: ', errors)
    averagePerSegment(errors)
    print('mean errors: ', errors)


"""
mean errors first round:
raw percentages {'lad_p': None, 'lad_m': None, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': None}
raw percentages {'lad_p': 41.313015853693784, 'lad_m': None, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': None}
raw percentages {'lad_p': 10.966248934731032, 'lad_m': None, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': None}
raw percentages {'lad_p': None, 'lad_m': 26.066242398934016, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': None}
raw percentages {'lad_p': 8.003781948507216, 'lad_m': 19.121593196430613, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': None} 
raw percentages {'lad_p': 38.77428614929597, 'lad_m': 43.85646968075416, 'lad_d': 12.041105703580937, 'lcx2_p': 75.9823148125468, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': None}
raw percentages {'lad_p': 11.854085439915279, 'lad_m': 89.22776182014374, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': None} 

raw errors (%):  {'lad_p': [46.686892761629004, 20.965261803413, 64.41693059993003, 79.77501597606043, 76.21308494070821, 48.358730182882766, 84.33393009324138, 89.32829073532372, 44.608162643862904, 86.82879395564969], 'lad_m': [6.831127032247775, 52.65183269808609, 44.22579874192373, 85.52712933460606, 83.0061080784261, 76.47130541090596, 30.331211994670078, 52.19601700892347, 45.179412899057304, 18.970349093524987], 'lad_d': [67.06007610999922, 36.769424627733585, 42.50495876832693, 75.91778859283812], 
'lcx2_p': [46.05357599877789, 8.546164017924006], 'lcx2_m': [], 'lcx2_d': [], 'diagonal': [], 'lcx1': []}
mean errors (%):  {'lad_p': 64.15150936927012, 'lad_m': 49.53902922923716, 'lad_d': 55.56306202472446, 'lcx2_p': 27.299870008350947, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': None}
"""

"""
with precise ptsalongline, measure against average width
raw errors:  {'lad_p': [11.831664367049102, 25.0, 13.4988099081334, 55.5623451908134, 41.057758717041345, 8.527013812769866, 42.126777584699965, 80.60141887036046, 8.806566229996012, 60.59140358765839], 'lad_m': [38.11178982424632, 53.39326144288472, 28.705381061326356, 70.83510610586582, 72.52425214311705, 77.84023758940849, 60.18189944857429, 45.681119916846804, 17.6448357821174, 31.535166026655986], 'lad_d': [39.53701510289559, 20.077322552482382, 7.179826179804963, 53.898808440836774], 'lcx2_p': [57.93049437536689, 31.189628167746204], 'lcx2_m': [], 'lcx2_d': [], 'diagonal': [4.246880957974864, 8.202558037653795, 30.174421326510263, 10.515341842787016, 3.415795275664877, 24.96485354936036, 0.08940455871107034], 'lcx1': [90.60528981178743, 14.23421038153944, 11.077553587200997, 22.345585861224627, 15.131008314394956]}        
mean errors:  {'lad_p': 34.76037582685219, 'lad_m': 49.64530493410433, 'lad_d': 30.173243069004926, 'lcx2_p': 44.56006127155655, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': 11.65846507838032, 'lcx1': 30.67872959122949}
"""

"""
with precise ptsalongline, adaptive width measure, correct coordinate ordering and gap detection for bends
raw errors:  {'lad_p': [40.93581846447678, 23.948410331735328, 20.014029619074318, 71.66852967639899, 70.96310417693672, 32.72093172742699, 62.616616534638204, 86.26664572674173, 31.351536819649773, 71.3784343001312], 'lad_m': [86.70116609464068, 54.24712243188075, 94.80730763415107, 76.17726937064, 87.00706062576576, 44.626697516416, 44.712837231688034, 35.546480122699656, 3.9679862921211493, 9.077566081825132], 'lad_d': [3.2957447187719304, 31.27050155541632, 72.89584720927479, 40.085650943899246], 'lcx2_p': [13.41681901676013, 17.570475476944836], 'lcx2_m': [], 'lcx2_d': [], 'diagonal': [46.579014644513514, 46.286680649762786, 44.35581147775295, 3.6084318000598143, 4.848241731471745, 17.74991681299719, 29.99700171603436], 'lcx1': [26.126698410187533, 44.63807955348782, 53.37218806062549, 8.847361295632835, 12.986670864350428]}
mean errors:  {'lad_p': 51.186405737720996, 'lad_m': 53.68714934018281, 'lad_d': 36.88693610684057, 'lcx2_p': 15.493647246852483, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': 27.63215697608462, 'lcx1': 29.19419963685682}
"""

"""
with precise ptsalongline
1388: raw percentages {'lad_p': None, 'lad_m': 45.55553041861184, 'lad_d': 20.537392472901853, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': None}
1472: raw percentages {'lad_p': 67.84798434973884, 'lad_m': 29.153827940409982, 'lad_d': None, 'lcx2_p': 78.96524718768373, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': 50.04116259608066, 'lcx1': None}
1494: raw percentages {'lad_p': 100.0, 'lad_m': 49.87339736767986, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': 95.30264490589377}
1523: raw percentages {'lad_p': 58.83194438693817, 'lad_m': 10.9725814722862, 'lad_d': 66.3299211927877, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': None}
1578: raw percentages {'lad_p': 23.11709576353861, 'lad_m': 15.178756342182288, 'lad_d': 27.581274832662253, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': 53.739320609437506, 'lcx1': 54.848544949769355}
1594: raw percentages {'lad_p': 30.041403919549083, 'lad_m': 6.192593885726845, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': 57.49371876833386, 'lcx1': 74.07826543450643}
1618: raw percentages {'lad_p': 69.80942304203653, 'lad_m': None, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': None}
1657: raw percentages {'lad_p': 25.31212254002636, 'lad_m': None, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': 99.07222019052793, 'lcx1': 83.89904183828519}
1673: raw percentages {'lad_p': None, 'lad_m': 24.825649544600754, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': 10.891639190495862, 'lcx1': None}
1691: raw percentages {'lad_p': 7.493321795769775, 'lad_m': 14.885598650748502, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': None, 'lcx1': None}
1738: raw percentages {'lad_p': 63.450020715430234, 'lad_m': 58.327136240586576, 'lad_d': 15.049346863486775, 'lcx2_p': 90.14947210268393, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': 99.97188283948829, 'lcx1': 79.44611056656655}
1778: raw percentages {'lad_p': 18.00958658509292, 'lad_m': 98.25359351113522, 'lad_d': None, 'lcx2_p': None, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': 75.33946256245709, 'lcx1': None}

raw errors (%):  {'lad_p': [71.10363029557674, 57.08370868635845, 12.738221197454342, 63.83982494281949, 90.00890427230696, 9.357113263671094, 79.98934823878565], 'lad_m': [79.76165821042362, 91.15343730610451, 24.12824772300377, 62.78600337312874, 27.09107969926678, 31.004791348180294], 'lad_d': [44.837450334675495, 69.90130627302645], 'lcx2_p': [28.78496014669133], 'lcx2_m': [], 'lcx2_d': [], 'diagonal': [23.229541986517848, 36.11809025740682, 10.080244656142144, 45.54180404752069, 24.96485354936036, 5.825671796928642], 'lcx1': [21.644935786043778, 17.69081618388174, 19.855774054693125, 13.494443666523637]}
mean errors (%):  {'lad_p': 54.874392985281816, 'lad_m': 52.65420294335129, 'lad_d': 57.36937830385097, 'lcx2_p': 28.78496014669133, 'lcx2_m': None, 'lcx2_d': None, 'diagonal': 24.293367715646085, 'lcx1': 18.17149242278557}

details:
1388:
    1388_42_lad:  {'p': 10.31461492214607, 'm': 39.05347955041552, 'd': 7.070041516003778}
    1388_43_lad:  {'p': 11.114385412162731, 'm': 22.848833435839786, 'd': 47.259774124454566}
    1388_44_lad:  {'p': 10.864882225303385, 'm': 22.66940852471223, 'd': 27.18461463699098}
    1388_45_lad:  {'p': 12.144283688016932, 'm': 41.99734767939408, 'd': 32.62050499784325}
    1388_46_lad:  {'p': 8.94778266147136, 'm': 28.31267366717646, 'd': 7.483372807659916}
    1388_47_lad:  {'p': 12.990039184386305, 'm': 73.88986270540438, 'd': 19.47120705409099}
    1388_48_lad:  {'p': 18.367331260851095, 'm': 27.311326986088027, 'd': 12.765693606144612}
    1388_49_lad:  {'p': 10.616028849471348, 'm': 33.04894729482325, 'd': 13.775387527886906}
    1388_50_lad:  {'p': 8.352104809081728, 'm': 28.26756584999649, 'd': 14.159105360986246}
    1388_51_lad:  {'p': 8.012074097653842, 'm': 79.00132282957772, 'd': 12.232427737202634}
    1388_52_lad:  {'p': 9.327743902438968, 'm': 88.73814425276211, 'd': 7.930183133912882}
    1388_53_lad:  {'p': 7.12027714773793, 'm': 98.53260340048546, 'd': 32.575955192957714}
    1388_54_lad:  {'m': 18.37663910120062, 'd': 11.259582501788357}
    1388_55_lad:  {'p': 9.28887529011413, 'm': 18.672992457042824, 'd': 36.94532894381803}
    1388_56_lad:  {'p': 5.6182522958453385, 'm': 27.85026908352287, 'd': 15.269912142441711}
    1388_57_lad:  {'p': 17.604300526775283, 'm': 16.831273651632582, 'd': 24.503441424736504}
    1388_58_lad:  {'p': 5.157712288360672, 'm': 30.892917556345644, 'd': 37.96761380246478}
    1388_59_lad:  {'p': 4.267821031912311, 'm': 12.144261023611602, 'd': 6.211406403223785}
    1388_60_lad:  {'p': 3.667638748569957, 'm': 72.56781124617349, 'd': 32.31447411170011}
    1388_61_lad:  {'p': 5.5535856100856655, 'm': 95.39400800941881, 'd': 17.042407134150118}
    1388_62_lad:  {'p': 22.59772279068687, 'm': 80.26445048522449, 'd': 15.24280777048107}
1472:
    1472_049_lad:  {'p': 44.39094877570493, 'm': 22.116977940414884, 'd': 8.839699074074158}
    1472_049_diagonal:  {'diagonal': 78.96524718768373}
    1472_049_lcx2:  {'p': 78.96524718768373, 'd': 21.226132500229745}
    1472_050_lad:  {'p': 22.14411777107155, 'm': 21.46622291051451}
    1472_050_diagonal:  {'diagonal': 86.79020801909026}
    1472_051_lad:  {'p': 37.85860090815749, 'm': 38.810976111010845, 'd': 10.161699542171675}
    1472_051_diagonal:  {'diagonal': 28.228942276096337}
    1472_059_lad:  {'p': 19.18781916374015, 'm': 100.0}
    1472_059_diagonal:  {'diagonal': 36.593765843254666}
    1472_060_lad:  {'p': 100.0, 'm': 7.12897050461031, 'd': 44.22664557605882}
    1472_060_diagonal:  {'diagonal': 11.124240306630206}
    1472_061_lad:  {'p': 100.0, 'm': 45.14772597449043, 'd': 4.65368143860061}
    1472_061_diagonal:  {'diagonal': 16.32523767550219}
    1472_062_lad:  {'p': 87.05037252897527, 'm': 8.225742047118278, 'd': 99.54796274919234}
    1472_062_diagonal:  {'diagonal': 60.41062292478442}
    1472_063_lad:  {'p': 100.0, 'm': 7.019697119667356, 'd': 100.0}
    1472_063_diagonal:  {'diagonal': 31.932199131684126}
    1472_065_lad:  {'p': 100.0, 'm': 12.46813885586321, 'd': 100.0}
    1472_065_diagonal:  {'diagonal': 100.0}
1494:
    1494_054_lad:  {'p': 100.0, 'm': 23.31524350330062, 'd': 55.04247693128943}
    1494_054_lcx1:  {'lcx1': 85.46260346907081}
    1494_055_lad:  {'p': 100.0, 'm': 6.798318585873686, 'd': 12.46036510140267}
    1494_055_lcx1:  {'lcx1': 94.49056158796502}
    1494_056_lad:  {'p': 100.0, 'd': 9.751025080206189}
    1494_056_lcx1:  {'lcx1': 100.0}
    1494_057_lad:  {'p': 100.0, 'm': 81.06070118984464, 'd': 42.32277809006318}
    1494_057_lcx1:  {'lcx1': 100.0}
    1494_058_lad:  {'p': 100.0, 'm': 100.0}
    1494_058_lcx1:  {'lcx1': 100.0}
    1494_059_lad:  {'p': 100.0, 'm': 76.51605304653393, 'd': 11.638927398037813}
    1494_059_lcx1:  {'lcx1': 88.8482339446594}
    1494_060_lad:  {'p': 100.0, 'm': 100.0, 'd': 5.7693182981918945}
    1494_060_lcx1:  {'lcx1': 74.8303398690299}
    1494_061_lad:  {'p': 100.0, 'm': 58.4445312722796, 'd': 5.093210506697132}
    1494_061_lcx1:  {'lcx1': 100.0}
    1494_062_lad:  {'p': 100.0, 'm': 69.78450955223062, 'd': 18.134067603494085}
    1494_062_lcx1:  {'lcx1': 100.0}
    1494_063_lad:  {'p': 100.0, 'm': 10.41807102757939, 'd': 11.82229199034478}
    1494_063_lcx1:  {'lcx1': 100.0}
    1494_064_lad:  {'p': 100.0, 'm': 5.838720404902298, 'd': 36.68745656276199}
    1494_064_lcx1:  {'lcx1': 100.0}
    1494_065_lad:  {'p': 100.0, 'm': 16.431222461933615, 'd': 23.264151777165765}
    1494_065_lcx1:  {'lcx1': 100.0}
1523:
    1523_36_lad:  {'p': 63.72286203027373, 'm': 3.7958911881607826, 'd': 65.97340642387115}
    1523_37_lad:  {'p': 30.21880909878204, 'm': 5.164243506763766, 'd': 76.4568854577621}
    1523_38_lad:  {'p': 71.31025846061665, 'm': 10.805841055725828, 'd': 81.61658719446596}
    1523_39_lad:  {'p': 27.176104282734737, 'm': 5.436709156674602, 'd': 72.80871501537123}
    1523_40_lad:  {'p': 45.23986821915314, 'm': 6.634040524184092, 'd': 13.71969519410512}
    1523_41_lad:  {'p': 96.12550494351385, 'm': 5.8827741109146015, 'd': 82.89850748216298}
    1523_42_lad:  {'p': 91.76944083988009, 'm': 16.477131040712866, 'd': 66.87893248888778}
    1523_43_lad:  {'p': 30.910903789178967, 'm': 4.945915765262754, 'd': 100.0}
    1523_44_lad:  {'p': 47.89664415964406, 'd': 82.80810409878893}
    1523_45_lad:  {'p': 27.132863162838206, 'm': 6.626531890416132, 'd': 64.98018008117232}
    1523_46_lad:  {'p': 72.99883228482966, 'm': 9.634903161027363, 'd': 70.42057086291634}
    1523_47_lad:  {'p': 85.94541992379214, 'm': 10.078830819979123, 'd': 60.0866429000378}
    1523_48_lad:  {'p': 100.0, 'm': 16.52386348679459, 'd': 52.48078823439973}
    1523_49_lad:  {'p': 31.128317402680405, 'm': 11.598106849337164, 'd': 59.146594457668144}
    1523_50_lad:  {'p': 78.18668498431649, 'm': 30.89003998453944, 'd': 72.27127220841588}
    1523_51_lad:  {'p': 41.54859660877667, 'm': 20.093899543799854, 'd': 38.73185698457774}
1578:
    1578_030_lad:  {'p': 17.34204563418865, 'm': 6.590322697676642, 'd': 19.50078738919563}
    1578_030_diagonal:  {'diagonal': 34.34763281747688}
    1578_030_lcx1:  {'lcx1': 79.04982908261744}
    1578_031_lad:  {'p': 14.832671518723895, 'm': 18.181818181818233, 'd': 73.45300878851776}
    1578_031_diagonal:  {'diagonal': 94.94114769435025}
    1578_031_lcx1:  {'lcx1': 38.973773911095066}
    1578_032_lad:  {'p': 17.526533580345227, 'm': 42.86291468072355, 'd': 23.450869790542683}
    1578_032_diagonal:  {'diagonal': 11.314181020889237}
    1578_032_lcx1:  {'lcx1': 57.20758095154865}
    1578_033_lad:  {'p': 22.801523635661567, 'm': 16.46360523629269, 'd': 27.16083256192039}
    1578_033_diagonal:  {'diagonal': 37.95456603270089}
    1578_033_lcx1:  {'lcx1': 64.40094382517272}
    1578_034_lad:  {'p': 25.295441330826517, 'm': 7.386336112471714, 'd': 26.693954860975587}
    1578_034_diagonal:  {'diagonal': 100.0}
    1578_034_lcx1:  {'lcx1': 52.8957720816595}
    1578_035_lad:  {'p': 19.2834466776155, 'm': 26.460468693024108, 'd': 15.117733025920854}
    1578_035_diagonal:  {'diagonal': 17.498426610102403}
    1578_035_lcx1:  {'lcx1': 77.22056367063642}
    1578_036_lad:  {'p': 21.110127676182078, 'm': 2.194298546714657, 'd': 9.402016236813227}
    1578_036_diagonal:  {'diagonal': 68.46222704168589}
    1578_036_lcx1:  {'lcx1': 78.02437735124911}
    1578_037_lad:  {'p': 16.280505347069095, 'm': 12.60382669207899, 'd': 13.555844047070643}
    1578_037_diagonal:  {'diagonal': 11.381411080048998}
    1578_037_lcx1:  {'lcx1': 66.28392609900688}
    1578_038_lad:  {'p': 33.777786038980295, 'm': 6.736395835749843, 'd': 13.894747828077648}
    1578_038_diagonal:  {'diagonal': 61.05799258174609}
    1578_038_lcx1:  {'lcx1': 30.68093446828284}
    1578_039_lad:  {'p': 25.307918680310028, 'm': 3.5344872807736016, 'd': 17.0834591387635}
    1578_039_diagonal:  {'diagonal': 59.68181322872468}
    1578_039_lcx1:  {'lcx1': 49.60313476802509}
    1578_040_lad:  {'p': 36.46278146794722, 'm': 8.800390010959491, 'd': 8.145001761374415}
    1578_040_diagonal:  {'diagonal': 17.629616604992048}
    1578_040_lcx1:  {'lcx1': 37.86495301371787}
    1578_041_lad:  {'p': 30.616021388567518, 'm': 16.21118472316737, 'd': 13.102308112099227}
    1578_041_diagonal:  {'diagonal': 26.140712658376053}
    1578_041_lcx1:  {'lcx1': 35.73646374644892}
    1578_042_lad:  {'p': 24.149662421244134, 'm': 16.694368515994917, 'd': 22.386674930297325}
    1578_042_diagonal:  {'diagonal': 80.36164382462997}
    1578_042_lcx1:  {'lcx1': 71.86812374600993}
    1578_043_lad:  {'p': 17.664482776003776, 'm': 16.90637414007292, 'd': 14.38150608052341}
    1578_043_diagonal:  {'diagonal': 87.63830732907178}
    1578_043_lcx1:  {'lcx1': 38.45547181803192}
    1578_044_lad:  {'p': 16.384504442718594, 'm': 11.265977712830821, 'd': 39.77884226277283}
    1578_044_diagonal:  {'diagonal': 82.16281973644095}
    1578_044_lcx1:  {'lcx1': 34.04560103509875}
    1578_045_lad:  {'p': 21.02499204940742, 'm': 6.315643040968178, 'd': 51.916001515688315}
    1578_045_diagonal:  {'diagonal': 100.0}
    1578_045_lcx1:  {'lcx1': 51.280018017847226}
    1578_046_lad:  {'p': 16.16638796723272, 'm': 26.504965304768014, 'd': 22.463700944660026}
    1578_046_diagonal:  {'diagonal': 58.78723661651091}
    1578_046_lcx1:  {'lcx1': 67.58752070886712}
    1578_047_lad:  {'p': 25.339641022904868, 'm': 63.24956800277259, 'd': 78.86381417484006}
    1578_047_diagonal:  {'diagonal': 17.594458160308456}
    1578_047_lcx1:  {'lcx1': 63.48289676174297}
    1578_048_lad:  {'p': 24.607814062900545, 'm': 28.250406826922493, 'd': 48.70758726398648}
    1578_048_diagonal:  {'diagonal': 22.069885780305544}
    1578_048_lcx1:  {'lcx1': 72.21403347764766}
    1578_049_lad:  {'p': 16.949300954437906, 'm': 5.30530530530533, 'd': 27.77867622866236}
    1578_049_diagonal:  {'diagonal': 54.51947541456401}
    1578_049_lcx1:  {'lcx1': 32.880004376723925}
    1578_050_lad:  {'p': 19.275426640705472, 'm': 9.436264198569532, 'd': 17.42283192353372}
    1578_050_diagonal:  {'diagonal': 67.56388185440163}
    1578_050_lcx1:  {'lcx1': 21.86536169478047}
    1578_051_lad:  {'p': 18.242256060412178, 'm': 15.970647966887409, 'd': 15.129519968612303}
    1578_051_diagonal:  {'diagonal': 71.94926073505621}
    1578_051_lcx1:  {'lcx1': 44.83610134840252}
    1578_052_lad:  {'p': 30.37722868297379, 'm': 16.828461446858224, 'd': 16.14327371165395}
    1578_052_diagonal:  {'diagonal': 20.33703153932056}
    1578_052_lcx1:  {'lcx1': 61.48846014403815}
    1578_053_lad:  {'p': 48.47581008350005, 'm': 7.515260583527816, 'd': 16.531190764869642}
    1578_053_diagonal:  {'diagonal': 7.374446525085654}
    1578_053_lcx1:  {'lcx1': 34.24482880101982}
    1578_054_lad:  {'p': 35.39378892531637, 'm': 14.187619021334186, 'd': 15.782621782063245}
    1578_054_diagonal:  {'diagonal': 19.322630260443752}
    1578_054_lcx1:  {'lcx1': 21.039377289377846}
    1578_055_lad:  {'p': 28.70762606376721, 'm': 24.468053908897758, 'd': 15.944399682585653}
    1578_055_diagonal:  {'diagonal': 41.017760423227166}
    1578_055_lcx1:  {'lcx1': 100.0}
    1578_056_lad:  {'p': 26.361763560861572, 'm': 17.81613795942635, 'd': 15.25310126949142}
    1578_056_diagonal:  {'diagonal': 100.0}
    1578_056_lcx1:  {'lcx1': 86.2664262063327}
    1578_057_lad:  {'p': 20.96705103669354, 'm': 4.253462341111702, 'd': 25.2111670514496}
    1578_057_diagonal:  {'diagonal': 19.176273260840905}
    1578_057_lcx1:  {'lcx1': 66.43463949281137}
    1578_058_lad:  {'p': 21.437948028295228, 'm': 4.056038791002758, 'd': 30.18536575900017}
    1578_058_diagonal:  {'diagonal': 100.0}
    1578_058_lcx1:  {'lcx1': 63.26855660293926}
    1578_059_lad:  {'p': 8.790706780656565, 'm': 7.723114890420868, 'd': 53.12788143076874}
    1578_059_diagonal:  {'diagonal': 79.10515426711179}
    1578_059_lcx1:  {'lcx1': 30.569382466147943}
    1578_060_lad:  {'p': 15.676774133247362, 'm': 5.767727958528257, 'd': 67.45079952579898}
    1578_060_diagonal:  {'diagonal': 96.52894579415005}
    1578_060_lcx1:  {'lcx1': 70.53583648556986}
1594:
    1594_045_lad:  {'m': 5.662932205763205, 'd': 8.42150020370146}
    1594_045_diagonal:  {'diagonal': 100.0}
    1594_045_lcx2:  {'p': 100.0, 'd': 28.871888917632482}
    1594_045_lcx1:  {'lcx1': 30.64161345672445}
    1594_046_lad:  {'p': 25.759644753605503}
    1594_046_diagonal:  {'diagonal': 76.56047894171981}
    1594_046_lcx2:  {'p': 85.49193509088329, 'd': 53.69061255819019}
    1594_046_lcx1:  {'lcx1': 30.607001323120087}
    1594_047_lad:  {'p': 19.485198252420044, 'm': 11.606626878477755}
    1594_047_diagonal:  {'diagonal': 100.0}
    1594_047_lcx2:  {'p': 13.013443186395602, 'd': 59.64258988703966}
    1594_047_lcx1:  {'lcx1': 68.64862635883881}
    1594_048_lad:  {'p': 96.88534460046563, 'm': 2.134925885529404, 'd': 4.294117755837545}
    1594_048_diagonal:  {'diagonal': 11.316552238750033}
    1594_048_lcx2:  {'d': 96.19020391865625}
    1594_048_lcx1:  {'lcx1': 25.2269160733821}
    1594_049_lad:  {'p': 9.68772288895109, 'm': 5.860839717206567, 'd': 2.8390853063682275}
    1594_049_diagonal:  {'diagonal': 9.086889306315072}
    1594_049_lcx2:  {'d': 100.0}
    1594_049_lcx1:  {'lcx1': 100.0}
    1594_050_lad:  {'p': 83.30507634304878, 'm': 4.15509735703189}
    1594_050_diagonal:  {'diagonal': 17.58992379673856}
    1594_050_lcx2:  {'p': 9.482182949383489, 'd': 100.0}
    1594_050_lcx1:  {'lcx1': 100.0}
    1594_051_lad:  {'p': 8.678049639147956}
    1594_051_diagonal:  {'diagonal': 8.794231201739223}
    1594_051_lcx2:  {'p': 28.576151034874965, 'd': 7.6286599692449775}
    1594_051_lcx1:  {'lcx1': 100.0}
    1594_052_lad:  {'p': 11.23587600863809, 'd': 4.5605986294987915}
    1594_052_diagonal:  {'diagonal': 100.0}
    1594_052_lcx2:  {'p': 35.439987923266436, 'd': 77.64440138637806}
    1594_052_lcx1:  {'lcx1': 66.70446605109039}
    1594_053_lad:  {'p': 5.292471373686103, 'm': 6.87811929480876, 'd': 12.517235778538838}
    1594_053_diagonal:  {'diagonal': 100.0}
    1594_053_lcx2:  {'p': 22.612319268469573, 'd': 60.32093560889415}
    1594_053_lcx1:  {'lcx1': 100.0}
    1594_054_lad:  {'p': 35.60869048719012, 'm': 5.14818153387655, 'd': 15.55832919651089}
    1594_054_diagonal:  {'diagonal': 14.386092173774045}
    1594_054_lcx2:  {'p': 22.09124966113708, 'd': 95.56257223017933}
    1594_054_lcx1:  {'lcx1': 93.0322965164151}
    1594_055_lad:  {'p': 4.475964848337544, 'm': 8.09402821312062, 'd': 6.801653291304066}
    1594_055_diagonal:  {'diagonal': 94.69673879263573}
    1594_055_lcx2:  {'p': 5.92026632940883, 'd': 100.0}
    1594_055_lcx1:  {'lcx1': 100.0}
1618:
    1618_28_lad:  {'p': 66.48830252634295, 'm': 18.378604817068357, 'd': 20.503509081491465}
    1618_29_lad:  {'p': 98.23523019206705, 'm': 93.98742540273138, 'd': 7.769206153585618}
    1618_30_lad:  {'p': 8.934138679697213, 'm': 100.0, 'd': 58.18447274140486}
    1618_31_lad:  {'p': 5.790595776198037, 'm': 100.0, 'd': 14.505863718541711}
    1618_32_lad:  {'p': 8.284262405698684, 'm': 27.06083200886732, 'd': 18.245447629839195}
    1618_33_lad:  {'p': 100.0, 'm': 5.569593938286044, 'd': 14.61839219301304}
    1618_34_lad:  {'p': 92.76603626802168, 'm': 4.1443362608379, 'd': 16.472324406542793}
    1618_35_lad:  {'p': 100.0, 'm': 5.149601050479968, 'd': 14.60476954941321}
    1618_36_lad:  {'p': 77.68805343500864, 'm': 7.709182742764331, 'd': 8.55745870925686}
    1618_37_lad:  {'p': 100.0, 'm': 12.107978302332857, 'd': 17.54480009734497}
    1618_38_lad:  {'p': 100.0, 'm': 13.196898352353115, 'd': 13.691037639684279}
    1618_39_lad:  {'p': 79.52645722140386, 'm': 25.70359796543412, 'd': 12.538083569937585}
1657:
    1657_036_lad:  {'p': 70.05711440126446, 'm': 9.173283767715802, 'd': 8.806612175357786}
    1657_036_diagonal:  {'diagonal': 100.0}
    1657_036_lcx1:  {'lcx1': 62.754688959685645}
    1657_037_lad:  {'p': 4.953363241777186, 'm': 12.957614715960798, 'd': 13.695261464286157}
    1657_037_diagonal:  {'diagonal': 98.03167518330334}
    1657_037_lcx1:  {'lcx1': 87.24881400129784}
    1657_038_lad:  {'m': 9.366264598889519, 'd': 19.427876784516506}
    1657_038_diagonal:  {'diagonal': 92.69052672197591}
    1657_038_lcx1:  {'lcx1': 100.0}
    1657_039_lad:  {'p': 8.141536990596776, 'm': 11.016006576720327, 'd': 13.615881450759272}
    1657_039_diagonal:  {'diagonal': 100.0}
    1657_039_lcx1:  {'lcx1': 100.0}
    1657_040_lad:  {'p': 12.489911567328916, 'm': 13.421285949508244, 'd': 11.474863610386466}
    1657_040_diagonal:  {'diagonal': 100.0}
    1657_040_lcx1:  {'lcx1': 87.57942348914887}
    1657_041_lad:  {'p': 8.641702793463013, 'm': 11.887536839594304, 'd': 9.640895273536376}
    1657_041_diagonal:  {'diagonal': 100.0}
    1657_041_lcx1:  {'lcx1': 71.31326206732265}
    1657_042_lad:  {'p': 9.342126789295847, 'm': 22.00278472871744, 'd': 23.714376347264366}
    1657_042_diagonal:  {'diagonal': 100.0}
    1657_042_lcx1:  {'lcx1': 30.094229865396827}
    1657_043_lad:  {'p': 12.241700095006792, 'm': 9.261144814900247, 'd': 6.636272764951068}
    1657_043_diagonal:  {'diagonal': 100.0}
    1657_043_lcx1:  {'lcx1': 100.0}
    1657_044_lad:  {'p': 90.2440313614968, 'm': 4.649706063409509, 'd': 5.06938024127469}
    1657_044_diagonal:  {'diagonal': 100.0}
    1657_044_lcx1:  {'lcx1': 100.0}
    1657_045_lad:  {'p': 11.69761562000744, 'm': 14.525103096157643, 'd': 8.53920060405432}
    1657_045_diagonal:  {'diagonal': 100.0}
    1657_045_lcx1:  {'lcx1': 100.0}
1673:
    1673_48_lad:  {'p': 4.747034859218557, 'm': 39.97068956722293, 'd': 4.790115418538877}
    1673_48_diagonal:  {'diagonal': 4.674240613493086}
    1673_49_lad:  {'m': 28.17521607854512, 'd': 8.88520332729068}
    1673_49_diagonal:  {'diagonal': 4.066692553351636}
    1673_50_lad:  {'p': 12.922683724950012, 'm': 24.596621091740012, 'd': 20.77604740655089}
    1673_50_diagonal:  {'diagonal': 6.25648385235179}
    1673_51_lad:  {'p': 6.1805579687939645, 'm': 28.36681851295957, 'd': 20.25461301692092}
    1673_51_diagonal:  {'diagonal': 18.510473954149465}
    1673_52_lad:  {'p': 6.4007493998070935, 'm': 26.76460207416297, 'd': 28.60270306912375}
    1673_52_diagonal:  {'diagonal': 7.4919921253193245}
    1673_53_lad:  {'p': 5.0836095831917945, 'm': 19.020660608245343, 'd': 20.51277957821793}
    1673_53_diagonal:  {'diagonal': 5.302614000963734}
    1673_54_lad:  {'p': 5.66024517407252, 'm': 37.66185288010646, 'd': 42.0364822360472}
    1673_54_diagonal:  {'diagonal': 10.21426444156106}
    1673_55_lad:  {'p': 6.205239905706339, 'm': 17.779161639356957, 'd': 71.78481139485761}
    1673_55_diagonal:  {'diagonal': 13.92491424255795}
    1673_56_lad:  {'p': 5.512715340442975, 'm': 10.795860166625049, 'd': 80.48975550308512}
    1673_56_diagonal:  {'diagonal': 15.023675888547972}
    1673_57_lad:  {'p': 4.087798176937197, 'm': 19.5984965912676, 'd': 35.847043244609836}
    1673_57_diagonal:  {'diagonal': 7.945453828873217}
    1673_58_lad:  {'p': 4.908527558985865, 'm': 20.352165780376286, 'd': 19.505888955789963}
    1673_58_diagonal:  {'diagonal': 26.397225594285246}
1691:
    1691_29_lad:  {'p': 5.807910898601287, 'm': 29.700245939562198, 'd': 74.93995193300755}
    1691_30_lad:  {'p': 11.475129533678817, 'm': 9.902320719644464, 'd': 21.086841009291412}
    1691_31_lad:  {'p': 10.235380783667193, 'm': 11.82256942535378, 'd': 5.267922565414517}
    1691_32_lad:  {'p': 7.6983893549184, 'm': 15.448011729412968, 'd': 11.18674600141929}
    1691_33_lad:  {'p': 9.481503272780767, 'm': 9.955200410464904, 'd': 14.236777139361545}
    1691_34_lad:  {'p': 3.414075450846432, 'm': 22.229704870486877}
    1691_35_lad:  {'m': 6.192906764832085, 'd': 18.49133212424232}
    1691_36_lad:  {'p': 3.1259467112994876, 'm': 7.251852377908707, 'd': 8.096093953654272}
    1691_37_lad:  {'p': 8.576674582889654, 'm': 4.754146353881561, 'd': 20.946942264540702}
    1691_38_lad:  {'p': 7.624885573245955, 'm': 31.599027915937494, 'd': 8.087766096553139}
1738:
    1738_38_lad:  {'p': 100.0, 'd': 30.72985701421872}
    1738_38_diagonal:  {'diagonal': 100.0}
    1738_38_lcx2:  {'p': 100.0, 'd': 63.909723492624025}
    1738_38_lcx1:  {'lcx1': 79.39698240015976}
    1738_39_lad:  {'p': 17.232074875215197, 'm': 88.46535342246887, 'd': 19.53981183304927}
    1738_39_diagonal:  {'diagonal': 100.0}
    1738_39_lcx2:  {'p': 100.0, 'd': 100.0}
    1738_39_lcx1:  {'lcx1': 69.02013775268094}
    1738_40_lad:  {'p': 64.05359450780652, 'm': 19.600391960039175, 'd': 20.44613066408356}
    1738_40_diagonal:  {'diagonal': 100.0}
    1738_40_lcx2:  {'p': 100.0, 'd': 77.17815591113076}
    1738_40_lcx1:  {'lcx1': 79.70890090163627}
    1738_41_lad:  {'p': 17.55424657018667, 'm': 30.17977072529543, 'd': 36.58055640476895}
    1738_41_diagonal:  {'diagonal': 100.0}
    1738_41_lcx2:  {'p': 100.0, 'd': 100.0}
    1738_41_lcx1:  {'lcx1': 45.30800853529674}
    1738_42_lad:  {'p': 76.39782297233577, 'm': 17.926235258968994, 'd': 10.328031947024119}
    1738_42_diagonal:  {'diagonal': 100.0}
    1738_42_lcx2:  {'p': 100.0, 'd': 80.00229908528466}
    1738_42_lcx1:  {'lcx1': 76.46378503707784}
    1738_43_lad:  {'p': 53.31549416795334, 'd': 24.99998996405922}
    1738_43_diagonal:  {'diagonal': 100.0}
    1738_43_lcx2:  {'p': 85.43186702759542, 'd': 96.63090383625534}
    1738_43_lcx1:  {'lcx1': 54.9918026713099}
    1738_44_lad:  {'p': 30.115036064360822, 'm': 63.11212245852113, 'd': 5.994001979878938}
    1738_44_diagonal:  {'diagonal': 100.0}
    1738_44_lcx2:  {'p': 100.0, 'd': 30.436553599250814}
    1738_44_lcx1:  {'lcx1': 100.0}
    1738_45_lad:  {'p': 23.008883413801673, 'd': 4.271167071403815}
    1738_45_diagonal:  {'diagonal': 100.0}
    1738_45_lcx2:  {'p': 100.0, 'd': 80.77310492465918}
    1738_45_lcx1:  {'lcx1': 100.0}
    1738_46_lad:  {'p': 96.1804450579799, 'm': 62.84153936734596}
    1738_46_diagonal:  {'diagonal': 99.57824259232437}
    1738_46_lcx2:  {'p': 100.0, 'd': 100.0}
    1738_46_lcx1:  {'lcx1': 57.374201028227944}
    1738_47_lad:  {'p': 99.59627500233445, 'm': 7.889862412100602, 'd': 21.33490653915404}
    1738_47_diagonal:  {'diagonal': 100.0}
    1738_47_lcx2:  {'p': 23.944034878179533, 'd': 86.20627957626009}
    1738_47_lcx1:  {'lcx1': 51.16072883892491}
    1738_48_lad:  {'p': 82.92530229913353, 'm': 9.91035928229872, 'd': 5.376125553956057}
    1738_48_diagonal:  {'diagonal': 100.0}
    1738_48_lcx2:  {'p': 67.93928166925926, 'd': 85.25121454578658}
    1738_48_lcx1:  {'lcx1': 83.718551972006}
    1738_49_lad:  {'p': 92.22811899619148, 'm': 100.0, 'd': 6.1709336400141535}
    1738_49_diagonal:  {'diagonal': 100.0}
    1738_49_lcx2:  {'p': 97.45572179118673, 'd': 84.515925232509}
    1738_49_lcx1:  {'lcx1': 100.0}
    1738_50_lad:  {'p': 91.33484833514503, 'm': 100.0, 'd': 6.86254111957717}
    1738_50_diagonal:  {'diagonal': 100.0}
    1738_50_lcx2:  {'p': 87.71819635612495, 'd': 56.72382986445522}
    1738_50_lcx1:  {'lcx1': 94.54855936117765}
    1738_51_lad:  {'p': 76.2615760598475, 'm': 100.0, 'd': 10.151763575126605}
    1738_51_diagonal:  {'diagonal': 100.0}
    1738_51_lcx2:  {'p': 100.0, 'd': 90.46494600616728}
    1738_51_lcx1:  {'lcx1': 100.0}
    1738_52_lad:  {'p': 31.546592409161743, 'm': 100.0, 'd': 7.905038782500251}
    1738_52_diagonal:  {'diagonal': 100.0}
    1738_52_lcx2:  {'p': 89.75297981791317, 'd': 84.78288603225252}
    1738_52_lcx1:  {'lcx1': 100.0}
1778:
    1778_037_lad:  {'p': 6.805100382804053, 'm': 100.0, 'd': 9.05547897595389}
    1778_037_diagonal:  {'diagonal': 31.708425809557017}
    1778_038_lad:  {'p': 12.588820464234974, 'm': 82.66288579106107, 'd': 15.08351884092346}
    1778_038_diagonal:  {'diagonal': 85.66402320149281}
    1778_039_lad:  {'p': 8.807335632023117, 'm': 100.0, 'd': 17.531205306341114}
    1778_039_diagonal:  {'diagonal': 97.78903383290964}
    1778_040_lad:  {'p': 9.057211007481369, 'm': 100.0, 'd': 9.409414267399441}
    1778_040_diagonal:  {'diagonal': 87.53066182214995}
    1778_041_lad:  {'p': 8.768183973298239, 'm': 100.0, 'd': 8.392099802412433}
    1778_041_diagonal:  {'diagonal': 88.15292934575803}
    1778_042_lad:  {'p': 9.733921882419116, 'm': 100.0, 'd': 18.339281200597913}
    1778_042_diagonal:  {'diagonal': 100.0}
    1778_043_lad:  {'p': 10.654008253191838, 'm': 100.0, 'd': 15.981188702001914}
    1778_043_diagonal:  {'diagonal': 93.62481299106057}
    1778_044_lad:  {'p': 14.351383368577153, 'm': 100.0, 'd': 25.01573261238712}
    1778_044_diagonal:  {'diagonal': 88.4983569862288}
    1778_045_lad:  {'p': 10.421898314954293, 'm': 100.0, 'd': 16.132552832622515}
    1778_046_lad:  {'p': 8.03363126523935, 'm': 100.0, 'd': 15.058039154280777}
    1778_046_diagonal:  {'diagonal': 82.95232264850105}
    1778_047_lad:  {'p': 23.084365137873995, 'm': 100.0, 'd': 13.747358267561715}
    1778_047_diagonal:  {'diagonal': 64.44670692678336}
    1778_048_lad:  {'p': 15.406515511099883, 'm': 100.0, 'd': 15.133342336506539}
    1778_048_diagonal:  {'diagonal': 20.563206032667004}
    1778_049_lad:  {'p': 84.63752538812966, 'm': 100.0, 'd': 48.0784380161787}
    1778_049_diagonal:  {'diagonal': 58.80297319764034}
    1778_050_lad:  {'p': 26.038126009693052, 'm': 100.0, 'd': 45.34887010115074}
    1778_050_diagonal:  {'diagonal': 89.30281175443142}
    1778_051_lad:  {'p': 21.75577218537368, 'm': 91.14101687596737, 'd': 16.56254840208584}
    1778_051_diagonal:  {'diagonal': 81.31563066258771}

"""


